# Mode, Destination, and Time of Day 

This document describes the input and output files used and generated by the Mode, 
Destination, and Time of Day (MDT) models. 

## Input Files

The descriptions here are focused on technical implementation,
i.e. what appears in these files, not where these values should come from.

In most cases, there are several possible locations for each input file, which 
are identified as "alternative file search locations"`under each heading.  In
each case, the model checks each location in the order shown to find the file,
and the first location where a file exists is the location actually used.  
Typically, files stored directly in the "Database" directory are preferred, but 
fallback files from other locations can also used.  This allows the MDT models to
run even if, for example, EMME has not been used to prepare a scenario specific
input file.

In addition to the files below, the MDT models also read a wide variety of skim
data from various EMME matrix files found in the `emmemat` directory.


### HW_CBDPARK.TXT

Alternative file search locations:
- HW_CBDPARK.TXT
- defaults_base_year/HW_CBDPARK.TXT

This file contains CBD parking cost inputs. Two different sets of records are 
included in the file. The first set identifies the parking supply characteristics 
of each CBD zone that contains parking. Each zone in this set has five records 
with the following information:

- CBD parking zone number.
- The probability of finding parking within the zone at the threshold parking 
  cost (this value must be 100 percent in each zone’s fifth record).
- The threshold parking cost in cents per hour.
- The savings in parking costs in cents per hour determined by subtracting the 
  threshold parking cost from the maximum parking cost in the zone.
- The amount of time needed to walk one block in the CBD (180 seconds).

Parking user characteristics are included in the second set of records in the 
CBD parking file – these correspond to the final five records in the file. These 
records are ordered by household income ranges and include the following variables 
for CBD commuters:

- The upper value of the household income quintile range (last record is the 
  lower bound of the highest quintile).
- The percentage of CBD auto commuters with free parking.
- The percentage of all CBD workers taking transit to CBD.
- The percentage of CBD auto commuters in single occupant vehicles.
- The percentage of CBD auto commuters ridesharing in two person vehicles
- The percentage of CBD auto commuters carpooling in three person vehicles.
- The percentage of CBD auto commuters carpooling in four or more person vehicles.


### ALLPURPOSE_M01.TXT

Alternative file search locations:
- ALLPURPOSE_M01.TXT
- defaults_base_year/ALLPURPOSE_M01.TXT

The M01 file stores several variables to provide the mode choice and distribution 
models with zonal transit availability and park and ride characteristic parameters. 
Some of the parameters are calculated using transit network characteristics and 
are specific to each scenario network. The contents of the M01 file are summarized:

1. Zone Number 
2. Zone Type  
   - 1=Chicago downtown
   - 2=Rest of Chicago
   - 3=dense suburban CBD
   - 4=all other zones
3. Park and Ride Cost  
     The cost of parking at the park and ride lot closest to the zone’s geographic 
     centroid. This represents the lowest rate of either the daily parking rate or the cost of a monthly parking pass divided by twenty work days.
4. Median zone household income  
     The median household income in the zone (in $100s)
5. Park and ride availability
     A binary value indicating that the zone has park and ride access if 
     there is a park and ride location within ten miles of the zone’s 
     geographic centroid.
6. Average waiting time for bus service in zone for home-work trips
7. Average waiting time for bus service in zone for non-work trips
8. Average waiting time for feeder bus service in zone for home-work trips
9. Average waiting time for feeder bus service in zone for non-work trips
10. Home-work trip auto work end auto occupancy

> Note: In prior version of the CMAP trip-based model, separate nearly identical copies 
> of the M01 files were needed to support pre-distribution and mode choice
> components, e.g. PDHW_M01 and MCHW_M01.  The current model does not require 
> separate files, so the model reads only a common file with an ALLPURPOSE prefix.


### ALLPURPOSE_M023.TXT

Alternative file search locations:
- ALLPURPOSE_M023.TXT
- defaults_base_year/ALLPURPOSE_M023.TXT

The M023 file contains transit fare and auto operating cost data used by the 
distribution and mode choice models. The file is composed of six records:

1. CTA fares;
2. Pace feeder bus fares;
3. Pace regional bus fares;
4. Auto operating costs in 5 mile per hour increments for speeds  
   between 0-40 miles per hour;
5. Auto operating costs in 5 mile per hour increments for speeds 
   between 40-80 miles per hour;
6. Average auto operating costs per mile by zone type used to estimate 
   transit access/egress costs.

The last record in the file contains the average per mile auto operating cost 
for each of the four zone types (defined in the M01 file). The M023 data is 
collapsed into six records. All values are reported in cents.

> Note: In prior version of the CMAP trip-based model, separate identical copies 
> of the M023 files were needed to support pre-distribution and mode choice
> components, e.g. PDHW_M023 and MCHW_M023.  The current model does not require 
> separate files, so the model reads only a common file with an ALLPURPOSE prefix.


### ??_DISTR.TXT

Variants:
- HW_DISTR.TXT
- HO_DISTR.TXT
- NH_DISTR.TXT

Alternative file search locations:
- ??_DISTR.TXT
- defaults_base_year/??_DISTR.TXT

The DISTR files contain zonal transit approach distribution parameters. The 
parameters are calculated using transit network characteristics and are thus 
specific to each scenario network. The following describes the DISTR file fields.

1. CMAP modeling zone number
2. Commuter Rail: Mean distance in miles to station
3. Commuter Rail: Standard deviation of distance to station
4. Commuter Rail: Type of Mode Choice distribution, with
   - 101 = normal distribution.
   - 102 = exponential distribution.
5. CTA Rail: Mean distance in miles to station
6. CTA Rail: Standard deviation of distance to station
7. CTA Rail: Type of Mode Choice distribution, with
   - 101 = normal distribution.
   - 102 = exponential distribution.
8. Regular Bus: Minimum bus stop distance
9. Regular Bus: Maximum bus stop distance
10. Regular Bus: Proportion of the zone within minimum walking distance
11. Feeder Bus: Minimum bus stop distance 
12. Feeder Bus: Maximum bus stop distance
13. Feeder Bus: Proportion of the zone within minimum walking distance
14. Park and Ride: Mean distance in miles to lot
15. Park and Ride: Standard deviation of distance to lot
16. Park and Ride: Type of Mode Choice distribution, with
    - 101 = normal distribution.
    - 102 = exponential distribution.

> Note: In prior version of the CMAP trip-based model, separate identical copies 
> of the DISTR files were needed to support pre-distribution and mode choice
> components, e.g. PDHW_DISTR and MCHW_DISTR.  The current model does not require 
> separate files, so the model reads only a common file without the component-
> specific prefix.


### cmap_trip_config.yaml

This yaml file contains a variety of model configurations, including:
- Taxi and TNC fare parameters
- Parking costs for zones other than those enumerated explicitly in `CBD_PARK`
- Intrazonal auto speeds by area type
- The regional income distribution across 5 income buckets
- Average occupancy of HOV3+ vehicles by trip purpose
- Activity durations by purpose (used to compute total parking costs)
- The number of replications used to simulate transit access and egress factors
- Factors by purpose to split trips into production-attraction and attraction-production
- Superdistrict codes for geographic validation summaries


### choice_model_params.yaml

Alternative file search locations:
- choice_model_params.yaml
- cache/choice_model_params.yaml

This file contains the choice model parameters used in the mode and destination 
model.  Mode and destination are modeled simultaneously in a single multi-level
nested logit structure.


### tod_model_params.yaml

Alternative file search locations:
- tod_model_params.yaml
- cache/tod_model_params.yaml

This file contains the choice model parameters used in the time-of-day model.
This model is only applied to auto trips, both private auto (sov, hov) and 
hired-car (taxi, tnc) modes.


### CMAP_Zone_Districts.csv.gz

Alternative file search locations:
- CMAP_Zone_Districts.csv.gz
- cache/CMAP_Zone_Districts.csv.gz

This file is used to attach district and super-district codes to the resulting
trip tables, primarily for validation purposes.


### TG_HHENUM_OUTPUT.TXT.gz

Alternative file search locations:
- TG_HHENUM_OUTPUT.TXT.gz
- cache/TG_HHENUM_OUTPUT.TXT.gz
- TG_HHENUM_OUTPUT.TXT
- cache/TG_HHENUM_OUTPUT.TXT
- defaults_base_year/TG_HHENUM_OUTPUT.TXT.gz

This file, which is created as an output of the trip generation model, lists the 
subzone and zone of each enumerated household, as well as the HHVTYPE. 


### value_of_time_buckets.csv

Alternative file search locations:
- value_of_time_buckets.csv
- cache/value_of_time_buckets.csv

This file describes the share of single occupant vehicles to put into each of the 
value of time buckets, based on trip purpose and household income group.  If a 
row does not sum to 1.0, the values will be scaled linearly so that the totals 
are 1 and all trips are assigned to a bucket.


### CMAP_TripTable_VisitorsWeekday.csv.gz

Alternative file search locations:
- cache/CMAP_TripTable_VisitorsWeekday.csv.gz
- CMAP_TripTable_VisitorsWeekday.csv.gz
- defaults_base_year/CMAP_TripTable_VisitorsWeekday.csv.gz

This file contains a pre-computed trip table for weekday visitors (i.e. non-CMAP
region residents).  It is used to replace the destination choice component for
visitor trips, although a mode choice model is still applied to distribute
visitor trips across modes.


### default_auto_propensity.csv.gz

Alternative file search locations:
- cache/computed_auto_propensity.csv
- computed_auto_propensity.csv
- defaults_base_year/default_auto_propensity.csv
- defaults_base_year/default_auto_propensity.csv.gz

This file contains the propensity of home-based trips to be attracted to a given
zone using a private auto mode (SOV or HOV).  It is used to adjust the probability
that non-home-based trips produced in this zone will also use a private auto mode.

To aid in computational efficiency, the model implementation uses computed auto
propensity lagged by one feedback iteration.  That is, the computed auto propensity 
from the prior global iteration is used at each iteration.  When there is no prior
iteration (i.e. on the first iteration) then the default auto propensity is used.


## Output Files

